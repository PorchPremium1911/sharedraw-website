<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SharedDraw - Social Drawing Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .post-animation { animation: slideIn 0.5s ease-out; }
        .heart-animation { animation: pulse 0.3s ease-in-out; }
        .notification-bounce { animation: bounce 0.6s ease-in-out; }
        .drawing-canvas { border: 2px solid #e5e7eb; border-radius: 8px; }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-purple-500">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold text-lg">S</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-800">SharedDraw</h1>
                </div>
                
                <!-- Search Bar -->
                <div class="flex-1 max-w-md mx-8">
                    <input type="text" id="searchInput" placeholder="Search users..." 
                           class="w-full px-4 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <div id="searchResults" class="absolute bg-white mt-1 rounded-lg shadow-lg hidden z-50 max-w-md"></div>
                </div>

                <!-- Auth Buttons -->
                <div id="authButtons" class="flex space-x-3">
                    <button onclick="showLogin()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition">Login</button>
                    <button onclick="showRegister()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">Register</button>
                </div>

                <!-- User Menu -->
                <div id="userMenu" class="hidden flex items-center space-x-4">
                    <span id="welcomeText" class="text-gray-700"></span>
                    <button onclick="toggleDrawMode()" id="drawModeBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">Draw</button>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Drawing Mode -->
        <div id="drawingMode" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Create Your Drawing</h2>
                
                <!-- Drawing Tools -->
                <div class="flex items-center space-x-4 mb-4">
                    <label class="text-gray-700">Brush Size:</label>
                    <input type="range" id="brushSize" min="1" max="20" value="5" class="w-32">
                    <span id="brushSizeValue" class="text-gray-600">5px</span>
                    
                    <label class="text-gray-700 ml-6">Color:</label>
                    <input type="color" id="brushColor" value="#000000" class="w-12 h-8 rounded border">
                    
                    <button onclick="clearCanvas()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition ml-6">Clear</button>
                </div>

                <!-- Canvas -->
                <canvas id="drawingCanvas" width="800" height="400" class="drawing-canvas bg-white mb-4"></canvas>
                
                <!-- Post Controls -->
                <div class="flex items-center space-x-4">
                    <input type="text" id="postCaption" placeholder="Add a caption..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <button onclick="publishDrawing()" class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition">Publish</button>
                </div>
            </div>
        </div>

        <!-- Feed -->
        <div id="feedMode">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Community Feed</h2>
            <div id="postsContainer" class="space-y-6"></div>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Login</h3>
            <form onsubmit="handleLogin(event)">
                <input type="text" id="loginUsername" placeholder="Username" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <input type="password" id="loginPassword" placeholder="Password" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-6 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 transition">Login</button>
                    <button type="button" onclick="closeModal('loginModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Register</h3>
            <form onsubmit="handleRegister(event)">
                <input type="text" id="registerUsername" placeholder="Username" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="email" id="registerEmail" placeholder="Email" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input type="password" id="registerPassword" placeholder="Password" required 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition">Register</button>
                    <button type="button" onclick="closeModal('registerModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Developer Panel -->
    <div id="devPanel" class="hidden fixed top-20 right-4 bg-red-600 text-white p-4 rounded-lg shadow-lg z-40">
        <h4 class="font-bold mb-2">üõ°Ô∏è Developer Panel</h4>
        <div id="reportsList" class="space-y-2 max-h-60 overflow-y-auto"></div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Report Post</h3>
            <form onsubmit="submitReport(event)">
                <textarea id="reportReason" placeholder="Reason for reporting..." required 
                          class="w-full px-4 py-3 border border-gray-300 rounded-lg mb-6 h-32 focus:outline-none focus:ring-2 focus:ring-red-500"></textarea>
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 transition">Submit Report</button>
                    <button type="button" onclick="closeModal('reportModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ban Modal -->
    <div id="banModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-red-600 mb-6">Ban User</h3>
            <p class="text-gray-700 mb-4">Are you sure you want to ban user: <span id="banUsername" class="font-bold"></span>?</p>
            <p class="text-sm text-gray-600 mb-6">Post ID: <span id="banPostId"></span></p>
            <div class="flex space-x-4">
                <button onclick="confirmBan()" class="flex-1 bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 transition">Ban User</button>
                <button onclick="closeModal('banModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-4">
                    <div id="profileAvatar" class="w-16 h-16 bg-gradient-to-r from-purple-400 to-blue-400 rounded-full flex items-center justify-center">
                        <span id="profileAvatarText" class="text-white text-2xl font-bold"></span>
                    </div>
                    <div>
                        <h3 id="profileUsername" class="text-2xl font-bold text-gray-800"></h3>
                        <p id="profileStats" class="text-gray-600"></p>
                    </div>
                </div>
                <button onclick="closeModal('profileModal')" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            </div>
            
            <div class="border-t pt-6">
                <h4 class="text-lg font-bold text-gray-800 mb-4">Recent Posts</h4>
                <div id="profilePosts" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let isDrawing = false;
        let canvas, ctx;
        let posts = [];
        let users = [];
        let reports = [];
        let bannedUsers = [];
        let currentReportPostId = null;
        let currentBanData = null;

        // Developer accounts
        const developers = {
            'PorchForeverX': 'imadmin01',
            'ChingTheDev': 'imadmin02'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCanvas();
            loadSampleData();
            renderFeed();
            setupSearch();
            
            // Check if user was previously logged in
            const savedUser = localStorage.getItem('sharedrawUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUIForLoggedInUser();
            }
        });

        function initializeCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            
            // Canvas event listeners
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Brush size slider
            document.getElementById('brushSize').addEventListener('input', function() {
                document.getElementById('brushSizeValue').textContent = this.value + 'px';
            });
        }

        function startDrawing(e) {
            if (!currentUser) return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function draw(e) {
            if (!isDrawing || !currentUser) return;
            const rect = canvas.getBoundingClientRect();
            const brushSize = document.getElementById('brushSize').value;
            const brushColor = document.getElementById('brushColor').value;
            
            ctx.lineWidth = brushSize;
            ctx.strokeStyle = brushColor;
            ctx.lineCap = 'round';
            ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function publishDrawing() {
            if (!currentUser) {
                alert('Please log in to publish drawings');
                return;
            }
            
            const caption = document.getElementById('postCaption').value;
            const imageData = canvas.toDataURL();
            
            if (ctx.getImageData(0, 0, canvas.width, canvas.height).data.some(channel => channel !== 0)) {
                const post = {
                    id: Date.now(),
                    author: currentUser.username,
                    caption: caption || 'Untitled Drawing',
                    image: imageData,
                    timestamp: new Date().toISOString(),
                    likes: 0,
                    likedBy: [],
                    comments: []
                };
                
                posts.unshift(post);
                clearCanvas();
                document.getElementById('postCaption').value = '';
                renderFeed();
                
                // Show success notification
                showNotification('Drawing published successfully!', 'success');
            } else {
                alert('Please draw something before publishing!');
            }
        }

        function loadSampleData() {
            // Sample users
            users = [
                { username: 'ArtistAlice', email: 'alice@example.com', isDev: false },
                { username: 'CreativeBob', email: 'bob@example.com', isDev: false },
                { username: 'SketchySarah', email: 'sarah@example.com', isDev: false }
            ];

            // Sample posts with SVG drawings
            posts = [
                {
                    id: 1,
                    author: 'ArtistAlice',
                    caption: 'Beautiful sunset landscape üåÖ',
                    image: createSampleDrawing('sunset'),
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    likes: 15,
                    likedBy: ['CreativeBob'],
                    comments: [
                        { author: 'CreativeBob', text: 'Amazing colors!', timestamp: new Date(Date.now() - 1800000).toISOString() }
                    ]
                },
                {
                    id: 2,
                    author: 'CreativeBob',
                    caption: 'Abstract art experiment üé®',
                    image: createSampleDrawing('abstract'),
                    timestamp: new Date(Date.now() - 7200000).toISOString(),
                    likes: 8,
                    likedBy: [],
                    comments: []
                },
                {
                    id: 3,
                    author: 'SketchySarah',
                    caption: 'Quick doodle of my cat üê±',
                    image: createSampleDrawing('cat'),
                    timestamp: new Date(Date.now() - 10800000).toISOString(),
                    likes: 23,
                    likedBy: ['ArtistAlice', 'CreativeBob'],
                    comments: [
                        { author: 'ArtistAlice', text: 'So cute!', timestamp: new Date(Date.now() - 9000000).toISOString() }
                    ]
                }
            ];
        }

        function createSampleDrawing(type) {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 400;
            const ctx = canvas.getContext('2d');
            
            // Create different sample drawings
            if (type === 'sunset') {
                // Gradient background
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, '#ff6b6b');
                gradient.addColorStop(0.5, '#ffa500');
                gradient.addColorStop(1, '#ffeb3b');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, 800, 400);
                
                // Sun
                ctx.fillStyle = '#ff4444';
                ctx.beginPath();
                ctx.arc(400, 200, 60, 0, Math.PI * 2);
                ctx.fill();
            } else if (type === 'abstract') {
                // Colorful shapes
                const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6'];
                for (let i = 0; i < 10; i++) {
                    ctx.fillStyle = colors[Math.floor(Math.random() * colors.length)];
                    ctx.fillRect(Math.random() * 700, Math.random() * 300, 100, 100);
                }
            } else if (type === 'cat') {
                // Simple cat drawing
                ctx.fillStyle = '#8b4513';
                // Body
                ctx.fillRect(300, 250, 200, 100);
                // Head
                ctx.beginPath();
                ctx.arc(400, 200, 80, 0, Math.PI * 2);
                ctx.fill();
                // Ears
                ctx.beginPath();
                ctx.moveTo(350, 150);
                ctx.lineTo(370, 120);
                ctx.lineTo(390, 150);
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(410, 150);
                ctx.lineTo(430, 120);
                ctx.lineTo(450, 150);
                ctx.fill();
            }
            
            return canvas.toDataURL();
        }

        function renderFeed() {
            const container = document.getElementById('postsContainer');
            container.innerHTML = '';
            
            posts.forEach(post => {
                if (bannedUsers.includes(post.author)) return;
                
                const postElement = document.createElement('div');
                postElement.className = 'bg-white rounded-xl shadow-lg p-6 post-animation';
                
                const isDev = developers.hasOwnProperty(post.author);
                const devBadge = isDev ? '<span class="text-blue-500 ml-2">‚úì</span>' : '';
                
                postElement.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-gradient-to-r from-purple-400 to-blue-400 rounded-full flex items-center justify-center cursor-pointer" onclick="showProfile('${post.author}')">
                                <span class="text-white font-bold">${post.author[0].toUpperCase()}</span>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-800 cursor-pointer hover:text-purple-600" onclick="showProfile('${post.author}')">${post.author}${devBadge}</h3>
                                <p class="text-sm text-gray-500">${formatTimestamp(post.timestamp)}</p>
                            </div>
                        </div>
                        ${currentUser ? <button onclick="reportPost(${post.id})" class="text-red-500 hover:text-red-700 text-sm">Report</button> : ''}
                    </div>
                    
                    <p class="text-gray-700 mb-4">${post.caption}</p>
                    <img src="${post.image}" alt="Drawing" class="w-full rounded-lg mb-4 border">
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            ${currentUser ? `
                                <button onclick="toggleLike(${post.id})" class="flex items-center space-x-2 ${post.likedBy.includes(currentUser.username) ? 'text-red-500' : 'text-gray-500'} hover:text-red-500 transition">
                                    <span class="text-xl">‚ù§Ô∏è</span>
                                    <span>${post.likes}</span>
                                </button>
                             : 
                                <div class="flex items-center space-x-2 text-gray-500">
                                    <span class="text-xl">‚ù§Ô∏è</span>
                                    <span>${post.likes}</span>
                                </div>
                            `}
                            <span class="text-gray-500">${post.comments.length} comments</span>
                        </div>
                    </div>
                    
                    <!-- Comments Section -->
                    <div class="mt-4 border-t pt-4">
                        <div class="space-y-3 mb-4">
                            ${post.comments.map(comment => {
                                const isCommentDev = developers.hasOwnProperty(comment.author);
                                const commentDevBadge = isCommentDev ? '<span class="text-blue-500 ml-1">‚úì</span>' : '';
                                return `
                                <div class="flex space-x-3">
                                    <div class="w-8 h-8 bg-gradient-to-r from-gray-400 to-gray-500 rounded-full flex items-center justify-center cursor-pointer" onclick="showProfile('${comment.author}')">
                                        <span class="text-white text-sm font-bold">${comment.author[0].toUpperCase()}</span>
                                    </div>
                                    <div class="flex-1">
                                        <div class="bg-gray-100 rounded-lg px-3 py-2">
                                            <p class="font-semibold text-sm text-gray-800 cursor-pointer hover:text-purple-600" onclick="showProfile('${comment.author}')">${comment.author}${commentDevBadge}</p>
                                            <p class="text-gray-700">${comment.text}</p>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">${formatTimestamp(comment.timestamp)}</p>
                                    </div>
                                </div>
                            `;}).join('')}
                        </div>
                        
                        ${currentUser ? `
                            <div class="flex space-x-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-purple-400 to-blue-400 rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-bold">${currentUser.username[0].toUpperCase()}</span>
                                </div>
                                <div class="flex-1 flex space-x-2">
                                    <input type="text" placeholder="Add a comment..." 
                                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                                           onkeypress="handleCommentKeypress(event, ${post.id})">
                                    <button onclick="addComment(${post.id})" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition">Post</button>
                                </div>
                            </div>
                        ` : '<p class="text-gray-500 text-center">Log in to comment</p>'}
                    </div>
                `;
                
                container.appendChild(postElement);
            });
        }

        function toggleLike(postId) {
            if (!currentUser) return;
            
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            const userIndex = post.likedBy.indexOf(currentUser.username);
            if (userIndex > -1) {
                post.likedBy.splice(userIndex, 1);
                post.likes--;
            } else {
                post.likedBy.push(currentUser.username);
                post.likes++;
                
                // Heart animation
                const heartBtn = event.target.closest('button');
                heartBtn.classList.add('heart-animation');
                setTimeout(() => heartBtn.classList.remove('heart-animation'), 300);
            }
            
            renderFeed();
        }

        function addComment(postId) {
            if (!currentUser) return;
            
            const post = posts.find(p => p.id === postId);
            if (!post) return;
            
            const commentInput = event.target.previousElementSibling;
            const commentText = commentInput.value.trim();
            
            if (commentText) {
                post.comments.push({
                    author: currentUser.username,
                    text: commentText,
                    timestamp: new Date().toISOString()
                });
                
                commentInput.value = '';
                renderFeed();
            }
        }

        function handleCommentKeypress(event, postId) {
            if (event.key === 'Enter') {
                addComment(postId);
            }
        }

        function reportPost(postId) {
            currentReportPostId = postId;
            document.getElementById('reportModal').classList.remove('hidden');
        }

        function submitReport(event) {
            event.preventDefault();
            
            const reason = document.getElementById('reportReason').value;
            const post = posts.find(p => p.id === currentReportPostId);
            
            if (post && reason) {
                const report = {
                    id: Date.now(),
                    postId: currentReportPostId,
                    postAuthor: post.author,
                    reportedBy: currentUser.username,
                    reason: reason,
                    timestamp: new Date().toISOString()
                };
                
                reports.push(report);
                updateDevPanel();
                
                closeModal('reportModal');
                document.getElementById('reportReason').value = '';
                showNotification('Report submitted successfully', 'success');
            }
        }

        function updateDevPanel() {
            if (!currentUser || !developers.hasOwnProperty(currentUser.username)) return;
            
            const panel = document.getElementById('devPanel');
            const reportsList = document.getElementById('reportsList');
            
            if (reports.length > 0) {
                panel.classList.remove('hidden');
                reportsList.innerHTML = reports.map(report => `
                    <div class="bg-red-700 p-3 rounded mb-2">
                        <p class="font-bold">Post by: ${report.postAuthor}</p>
                        <p class="text-sm">Reported by: ${report.reportedBy}</p>
                        <p class="text-sm">Reason: ${report.reason}</p>
                        <button onclick="showBanModal('${report.postAuthor}', ${report.postId})" 
                                class="bg-red-800 text-white px-3 py-1 rounded mt-2 hover:bg-red-900 transition">
                            Ban User
                        </button>
                    </div>
                `).join('');
            } else {
                panel.classList.add('hidden');
            }
        }

        function showBanModal(username, postId) {
            currentBanData = { username, postId };
            document.getElementById('banUsername').textContent = username;
            document.getElementById('banPostId').textContent = postId;
            document.getElementById('banModal').classList.remove('hidden');
        }

        function confirmBan() {
            if (currentBanData) {
                bannedUsers.push(currentBanData.username);
                
                // Remove reports for this user
                reports = reports.filter(report => report.postAuthor !== currentBanData.username);
                
                updateDevPanel();
                renderFeed();
                closeModal('banModal');
                
                showNotification(User ${currentBanData.username} has been banned, 'success');
                currentBanData = null;
            }
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length > 0) {
                    const filteredUsers = users.filter(user => 
                        user.username.toLowerCase().includes(query) && 
                        !bannedUsers.includes(user.username)
                    );
                    
                    if (filteredUsers.length > 0) {
                        searchResults.innerHTML = filteredUsers.map(user => {
                            const isDev = developers.hasOwnProperty(user.username);
                            const devBadge = isDev ? '<span class="text-blue-500 ml-2">‚úì</span>' : '';
                            
                            return `
                                <div class="p-3 hover:bg-gray-100 cursor-pointer border-b" onclick="showProfile('${user.username}')">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-8 h-8 bg-gradient-to-r from-purple-400 to-blue-400 rounded-full flex items-center justify-center">
                                            <span class="text-white text-sm font-bold">${user.username[0].toUpperCase()}</span>
                                        </div>
                                        <span class="font-medium">${user.username}${devBadge}</span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                        searchResults.classList.remove('hidden');
                    } else {
                        searchResults.innerHTML = '<div class="p-3 text-gray-500">No users found</div>';
                        searchResults.classList.remove('hidden');
                    }
                } else {
                    searchResults.classList.add('hidden');
                }
            });
            
            // Hide search results when clicking outside
            document.addEventListener('click', function(event) {
                if (!searchInput.contains(event.target) && !searchResults.contains(event.target)) {
                    searchResults.classList.add('hidden');
                }
            });
        }

        function showLogin() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('registerModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            // Check if banned
            if (bannedUsers.includes(username)) {
                alert('This account has been banned.');
                return;
            }
            
            // Check developer accounts
            if (developers[username] === password) {
                currentUser = { username, isDev: true };
                localStorage.setItem('sharedrawUser', JSON.stringify(currentUser));
                updateUIForLoggedInUser();
                closeModal('loginModal');
                showNotification(Welcome back, ${username}! üõ°Ô∏è, 'success');
                updateDevPanel();
                return;
            }
            
            // Check regular users
            const user = users.find(u => u.username === username);
            if (user) {
                currentUser = { username, isDev: false };
                localStorage.setItem('sharedrawUser', JSON.stringify(currentUser));
                updateUIForLoggedInUser();
                closeModal('loginModal');
                showNotification(Welcome back, ${username}!, 'success');
            } else {
                alert('Invalid username or password');
            }
            
            // Clear form
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function handleRegister(event) {
            event.preventDefault();
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            // Check if username already exists
            if (users.some(u => u.username === username) || developers.hasOwnProperty(username)) {
                alert('Username already exists');
                return;
            }
            
            // Add new user
            const newUser = { username, email, isDev: false };
            users.push(newUser);
            
            currentUser = { username, isDev: false };
            localStorage.setItem('sharedrawUser', JSON.stringify(currentUser));
            updateUIForLoggedInUser();
            closeModal('registerModal');
            showNotification(Welcome to SharedDraw, ${username}!, 'success');
            
            // Clear form
            document.getElementById('registerUsername').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('sharedrawUser');
            updateUIForLoggedOutUser();
            showNotification('Logged out successfully', 'info');
        }

        function updateUIForLoggedInUser() {
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            
            const devBadge = currentUser.isDev ? ' üõ°Ô∏è' : '';
            document.getElementById('welcomeText').textContent = Welcome, ${currentUser.username}${devBadge};
            
            renderFeed();
            
            if (currentUser.isDev) {
                updateDevPanel();
            }
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userMenu').classList.add('hidden');
            document.getElementById('drawingMode').classList.add('hidden');
            document.getElementById('feedMode').classList.remove('hidden');
            document.getElementById('drawModeBtn').textContent = 'Draw';
            document.getElementById('devPanel').classList.add('hidden');
            
            renderFeed();
        }

        function toggleDrawMode() {
            const drawingMode = document.getElementById('drawingMode');
            const feedMode = document.getElementById('feedMode');
            const drawModeBtn = document.getElementById('drawModeBtn');
            
            if (drawingMode.classList.contains('hidden')) {
                drawingMode.classList.remove('hidden');
                feedMode.classList.add('hidden');
                drawModeBtn.textContent = 'Feed';
            } else {
                drawingMode.classList.add('hidden');
                feedMode.classList.remove('hidden');
                drawModeBtn.textContent = 'Draw';
            }
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return ${Math.floor(diff / 60000)}m ago;
            if (diff < 86400000) return ${Math.floor(diff / 3600000)}h ago;
            return ${Math.floor(diff / 86400000)}d ago;
        }

        function showProfile(username) {
            // Hide search results
            document.getElementById('searchResults').classList.add('hidden');
            
            // Check if user exists and is not banned
            if (bannedUsers.includes(username)) {
                showNotification('This user has been banned', 'error');
                return;
            }
            
            const isDev = developers.hasOwnProperty(username);
            const devBadge = isDev ? ' ‚úì' : '';
            
            // Get user's posts
            const userPosts = posts.filter(post => post.author === username);
            const totalLikes = userPosts.reduce((sum, post) => sum + post.likes, 0);
            
            // Update profile modal
            document.getElementById('profileAvatarText').textContent = username[0].toUpperCase();
            document.getElementById('profileUsername').textContent = username + devBadge;
            document.getElementById('profileStats').textContent = ${userPosts.length} posts ‚Ä¢ ${totalLikes} total likes;
            
            // Render user's posts
            const profilePostsContainer = document.getElementById('profilePosts');
            if (userPosts.length > 0) {
                profilePostsContainer.innerHTML = userPosts.map(post => `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <p class="font-medium text-gray-800">${post.caption}</p>
                            <span class="text-sm text-gray-500">${formatTimestamp(post.timestamp)}</span>
                        </div>
                        <img src="${post.image}" alt="Drawing" class="w-full rounded-lg mb-2 border max-h-48 object-contain">
                        <div class="flex items-center space-x-4 text-sm text-gray-600">
                            <span>‚ù§Ô∏è ${post.likes}</span>
                            <span>üí¨ ${post.comments.length}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                profilePostsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">No posts yet</p>';
            }
            
            // Show profile modal
            document.getElementById('profileModal').classList.remove('hidden');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 notification-bounce ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962937b7d029731f',t:'MTc1MzA4NTM4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

